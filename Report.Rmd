---
title: "Kibuon Data Analysis"
author: "Billy Koech"
date: "9/29/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

# milestone #4 packages
library(tidyverse)
library("janitor")
library(dplyr)
library(readxl) # package for importing data


```

# Meeting with CA (Milestone #1)
Met with Enxhi Buxhel

# Review of past projects (Milestone #2)
Riviewed and discussed the pros and cons of two past projects

# Description of the data (Milestone #3)

## Source of data
### Background

I am a member of the Harvard SEAS Engineers Without Borders Chapter. In this student organization we work on projects located in developing countries to provide engineering solutions to challenges faced by local communities. One of our projects in Kenya deal with the provision of clean portable water to the communities. In the summer of 2019, I travelled to Kenya with a team of 8 to collect data on water usage trends and needs in the community. That collected data is availble in an excel sheet [here](raw-data/survey_data.xlsx)

While in the community we also collected geospatial data and created a google earth kmz map. The kmz file can be found [here](raw-data/map.kmz).

## What you have done with it so far and what you plan to do?


I wrote a python script to parse the Kmz data into json file. I plan to use the jsonlite or rjson library to parse this data from json to a R data frame. I then plan to link the geospatial data to the rows in the survey data excel sheet and create map visualisations from which one can infer trends pertaining to water usage and need.



# Milestone #4 



```{r RAW DATA: WATER USAGE PLOT}
# load data
file_path <- "raw-data/survey_data.xlsx"

survey_data <- read_xlsx(file_path, 
                        range = cell_rows(1:41)) %>%
                        clean_names()


# graph of household liters per day versus number of people

survey_data %>%
  ggplot(aes(x = total,
             y = household_liters_day,
             color = wet_season_water_source)) + 
  geom_line() + 
  labs(
    x = "Total number of people in household",
    title = "Water usage trends",
    y = "Liters of water used per day per household",
    color = "Water sources"
  )
```


```{r AGE DISTRIBUTION}
# distribution of ages in the community

combined_ages <- survey_data %>%
  mutate(under5 = x5_under_m + x5_under_f,
         from_6_to_14 = x6_14_m + x6_14_f,
         from_15_to_62 = x15_62_f + x15_62_m,
         over62 = over_62_m + over_62_f)

# gather the table
gathered_ages <-gather(combined_ages,
                       key = "age_range",
                       value = "number_of_people",
                       under5:over62,
                       na.rm = TRUE) 


# age_dist_df <- data.frame(age_range = rep(gathered_ages$age_range, times = gathered_ages$number_of_people))


# WRITE CLEAN DATA TO FOLDER
write.csv(gathered_ages, "web_app_kibuon_data/gathered_ages.csv")


# plot distribution
ggplot(gathered_ages, aes(x = age_range,
                          y = number_of_people,
                          group = age_range)) +
  geom_col(fill = "#6ef0d1") +
  labs(
    x = "Age range",
    title = "Distribution of ages in the community",
    subtitle = "Which age group has the largest population?",
    y = "Number of people"
  )


```



# Milestone #5

See about page



# Milestone #6

See web app folder called [web_app_kibuon_data](web_app_kibuon_data/)


# Milestone #7
Made about page

# Milestone #8
```{r DATA SOURCES}
# import needed libraries
library(sf)

# load the remaining data

# shape_file
# generated from
map_zip_file <- "raw-data/mygeodata.zip"
unzip(map_zip_file, overwrite = TRUE, exdir = "raw-data/")


# DATA Source 1:
map_of_kibuon <- st_read("raw-data/Kibuon_Map_-_Oct_15/Geographic_Borders-polygon.shp")

# DATA Source 2:
distances_to_wells <- read.csv("parsing-data/distances_to_wells.csv") %>% clean_names()

# DATA Source 3:
distances_to_water_sources <- read.csv("parsing-data/distances_to_water_sources.csv") %>% clean_names()

# left join to create a combined table
combined <- left_join(distances_to_wells, distances_to_water_sources, by = c("house_code", "long", "lat"))

converted_to_sf <- st_as_sf(combined, coords = c("long","lat"), crs = 4326)
```


```{r}
# Create a map showing population
ggplot(converted_to_sf) +
    geom_sf(data = map_of_kibuon) +
    geom_sf(data = converted_to_sf) +
  geom_sf(aes(size = number_of_people)) +
  labs(title = "Spatial distribution of houses in the community of Kibuon",
         subtitle = "Circle sizes correspond to number of people in the house",
         x = "Longitude",
         y = "Lattitude") 

# save plot locally
ggsave("spatial_dist.png", plot = last_plot(), device = "png", path ="web_app_kibuon_data/", scale = 1)


# create model of water usage as a function of location, or as function of number of people in the household
# then test the data on the 
```


```{r}
file_path <- "distances.xlsx"
distances_data<- read_xlsx(file_path) %>%
                        clean_names()


# distribuion plots

distances_data %>% ggplot(aes(x = distance_to_kater)) + geom_histogram(binwidth = 100) + xlim(0, 3000)

distances_data %>% ggplot(aes(x = distance_to_ombolwanda)) + geom_histogram() + xlim(0, 3000)

distances_data %>% ggplot(aes(x = distance_to_kawegi)) + geom_histogram() + xlim(0, 3000)

distances_data %>% ggplot(aes(x = distance_to_munyu )) + geom_histogram()+ xlim(0, 3000)


```

